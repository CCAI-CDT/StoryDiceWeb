!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Story Dice - STAR Model</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse-go { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .pulse-go { animation: pulse-go 1.5s ease-in-out infinite; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;

    const options = {
      character: ['Car', 'Alien', 'Astronaut', 'Dinosaur', 'Scientist', 'Dog'],
      adjective: ['Magical', 'Smart', 'Brave', 'Friendly', 'Curious', 'Giant'],
      tone: ['Silly', 'Happy', 'Mysterious', 'Boring', 'Educational', 'Surprising'],
      role: ['A Toddler', 'Teacher', 'Scientist', 'Robot', 'News Reporter', 'Grandmother']
    };

    const starLabels = {
      character: { letter: 'S', word: 'Specific', desc: 'Who is in your story?' },
      adjective: { letter: 'S', word: 'Specific', desc: 'What are they like?' },
      tone: { letter: 'T', word: 'Tone', desc: 'How does it feel?' },
      role: { letter: 'R', word: 'Role', desc: 'Who tells the story?' }
    };

    const colors = {
      character: { bg: 'bg-blue-500', light: 'bg-blue-100', border: 'border-blue-400', text: 'text-blue-700' },
      adjective: { bg: 'bg-blue-500', light: 'bg-blue-100', border: 'border-blue-400', text: 'text-blue-700' },
      tone: { bg: 'bg-red-500', light: 'bg-red-100', border: 'border-red-400', text: 'text-red-700' },
      role: { bg: 'bg-green-500', light: 'bg-green-100', border: 'border-green-400', text: 'text-green-700' }
    };

    const DiceIcon = ({ rolling }) => (
      <svg className={`w-5 h-5 ${rolling ? 'animate-spin' : ''}`} viewBox="0 0 24 24" fill="currentColor">
        <rect x="3" y="3" width="18" height="18" rx="3" stroke="currentColor" strokeWidth="2" fill="none"/>
        <circle cx="8" cy="8" r="1.5"/><circle cx="16" cy="8" r="1.5"/>
        <circle cx="8" cy="16" r="1.5"/><circle cx="16" cy="16" r="1.5"/>
        <circle cx="12" cy="12" r="1.5"/>
      </svg>
    );

    const DiceSection = ({ type, selected, onSelect, onRoll, rolling }) => {
      const c = colors[type];
      const label = starLabels[type];
      
      return (
        <div className={`${c.light} rounded-2xl p-4 border-2 ${c.border}`}>
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-2">
              <span className={`${c.bg} text-white font-bold px-2 py-1 rounded-lg text-sm`}>
                {label.letter} = {label.word}
              </span>
              <span className={`${c.text} font-semibold capitalize`}>{type}</span>
            </div>
            <button
              onClick={onRoll}
              disabled={rolling}
              className={`${c.bg} text-white px-3 py-1.5 rounded-lg font-bold flex items-center gap-1 hover:opacity-90 transition-all ${rolling ? 'scale-110' : ''}`}
            >
              <DiceIcon rolling={rolling} /> Roll!
            </button>
          </div>
          <p className={`${c.text} text-sm mb-2 opacity-75`}>{label.desc}</p>
          <div className="grid grid-cols-3 gap-2">
            {options[type].map((opt) => (
              <button
                key={opt}
                onClick={() => onSelect(opt)}
                className={`px-2 py-2 rounded-xl text-sm font-medium transition-all transform hover:scale-105 ${
                  selected === opt
                    ? `${c.bg} text-white shadow-lg scale-105`
                    : 'bg-white text-gray-700 hover:bg-gray-50 border border-gray-200'
                }`}
              >
                {opt}
              </button>
            ))}
          </div>
          {selected && (
            <button
              onClick={() => onSelect(null)}
              className="mt-2 text-xs text-gray-500 hover:text-gray-700 underline"
            >
              Clear selection
            </button>
          )}
        </div>
      );
    };

    function AIStoryDice() {
      const [selections, setSelections] = useState({ character: null, adjective: null, tone: null, role: null });
      const [rolling, setRolling] = useState({});
      const [story, setStory] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [promptRecipe, setPromptRecipe] = useState('')

      const handleSelect = (type, value) => {
        setSelections(prev => ({ ...prev, [type]: value }));

        // Clearing old story
        setStory('')

        // Update prompt recipe
        // const selectionPlaceholders = {
        //   character: selections.character ? '$character' : '', 
        //   adjective: selections.adjective ? '$adjective' : '', 
        //   tone: selections.tone ? '$tone' : '', 
        //   role: selections.role ? '$role' : '',
        // }
        const prompt = buildPrompt(selections);
        console.log(prompt);
        setPromptRecipe('' + prompt);
      };

      const handleRoll = (type) => {
        setRolling(prev => ({ ...prev, [type]: true }));
        let count = 0;
        const interval = setInterval(() => {
          const randomOpt = options[type][Math.floor(Math.random() * 6)];
          setSelections(prev => ({ ...prev, [type]: randomOpt }));
          count++;
          if (count > 10) {
            clearInterval(interval);
            setRolling(prev => ({ ...prev, [type]: false }));
          }
        }, 100);
      };

      const rollAll = () => {
        ['character', 'adjective', 'tone', 'role'].forEach((type, i) => {
          setTimeout(() => handleRoll(type), i * 200);
        });
      };

      const buildPrompt = (selections) => {
        const { character, adjective, tone, role } = selections;
        const hasAny = character || adjective || tone || role;
        if (!hasAny) return null;

        let prompt = '';
        if (role) prompt += `You are ${role.toLowerCase()} telling a story. `;
        else prompt += 'You are a storyteller. ';
        
        prompt += 'Write in exactly 3-4 sentences for children aged 7-10 about ';
        
        if (adjective && character) prompt += `a ${adjective.toLowerCase()} ${character.toLowerCase()}. `;
        else if (adjective) prompt += `something ${adjective.toLowerCase()}. `;
        else if (character) prompt += `a ${character.toLowerCase()}. `;
        else prompt += 'an adventure. ';
        
        if (tone) prompt += `Your story MUST be ${tone.toLowerCase()} - make sure the ${tone.toLowerCase()} feeling is very clear and obvious. `;
        
        prompt += 'Use simple words';
        if (role) prompt += ` and make your ${role.toLowerCase()} personality shine through in how you tell the story`;
        prompt += '. Make this story completely different from any other story.';
        
        return prompt;
      };

      const generateStory = async () => {
        const prompt = buildPrompt(selections);
        if (!prompt) {
          setError('Please select at least one option!');
          return;
        }
        
        setLoading(true);
        setError('');
        setStory('');
        
        try {
          const response = await fetch('http://localhost:1234/v1/chat/completions', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              model: 'local-model',
              messages: [{ role: 'user', content: prompt }],
              temperature: 0.9,
              max_tokens: 200
            })
          });
          
          if (!response.ok) throw new Error('Could not connect to LM Studio');
          const data = await response.json();
          setStory(data.choices[0].message.content);
        } catch (err) {
          setError('Make sure LM Studio is running on localhost:1234!');
        }
        setLoading(false);
      };

      const hasSelection = Object.values(selections).some(v => v);

      return (
        <div className="min-h-screen bg-gradient-to-br from-cyan-500 via-cyan-300 to-cyan-50 p-4">
          <div className="max-w-4xl mx-auto">
            <div className="text-center mb-6">
              <h1 className="text-4xl font-black text-white mb-2 drop-shadow-lg">
                üé≤ AI Story Dice üé≤
              </h1>
              <p className="text-xl text-purple-200">Learn the STAR Model of Prompt Engineering!</p>
              <div className="flex justify-center gap-2 mt-3 flex-wrap">
                <span className="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-bold">S = Specific</span>
                <span className="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">T = Tone</span>
                <span className="bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-bold">A = Audience (7-10)</span>
                <span className="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">R = Role</span>
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-4 mb-6">
              <DiceSection type="character" selected={selections.character} onSelect={(v) => handleSelect('character', v)} onRoll={() => handleRoll('character')} rolling={rolling.character} />
              <DiceSection type="adjective" selected={selections.adjective} onSelect={(v) => handleSelect('adjective', v)} onRoll={() => handleRoll('adjective')} rolling={rolling.adjective} />
              <DiceSection type="tone" selected={selections.tone} onSelect={(v) => handleSelect('tone', v)} onRoll={() => handleRoll('tone')} rolling={rolling.tone} />
              <DiceSection type="role" selected={selections.role} onSelect={(v) => handleSelect('role', v)} onRoll={() => handleRoll('role')} rolling={rolling.role} />
            </div>

            <div className="flex justify-center gap-4 mb-6">
              <button
                onClick={rollAll}
                className="bg-white text-purple-700 px-6 py-3 rounded-2xl font-bold text-lg hover:bg-purple-100 transition-all transform hover:scale-105 shadow-lg"
              >
                üé≤ Roll All Dice!
              </button>
              <button
                onClick={generateStory}
                disabled={loading || !hasSelection}
                className={`px-10 py-4 rounded-2xl font-black text-2xl transition-all transform shadow-xl ${
                  hasSelection && !loading
                    ? 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white hover:scale-110 hover:shadow-2xl pulse-go'
                    : 'bg-gray-400 text-gray-200 cursor-not-allowed'
                }`}
              >
                {loading ? '‚ú® Creating...' : '‚ñ∂Ô∏è GO!'}
              </button>
            </div>

           {hasSelection && (
  <div className="bg-white/90 rounded-2xl p-4 mb-4 shadow-lg">
    <h3 className="font-bold text-gray-700 mb-2">Your Prompt Recipe:</h3>
    <div className="flex flex-wrap gap-2 mb-4">
      {selections.role && <span className="bg-green-500 text-white px-3 py-1 rounded-full">{selections.role}</span>}
      {selections.adjective && <span className="bg-blue-500 text-white px-3 py-1 rounded-full">{selections.adjective}</span>}
      {selections.character && <span className="bg-purple-500 text-white px-3 py-1 rounded-full">{selections.character}</span>}
      {selections.tone && <span className="bg-red-500 text-white px-3 py-1 rounded-full">{selections.tone}</span>}
    </div>
    <h3 className="font-bold text-gray-700 mb-2">üìù The Prompt We Send to the AI:</h3>
    <div className="bg-gray-100 rounded-xl p-3 border-2 border-dashed border-gray-300">
      <p className="text-gray-800 font-mono text-sm">{buildPrompt(selections)}</p>
    </div>
  </div>
)}

            {error && (
              <div className="bg-red-100 border-2 border-red-400 text-red-700 rounded-2xl p-4 mb-4 text-center font-medium">
                {error}
              </div>
            )}

            {story && (
              <div className="bg-white rounded-3xl p-6 shadow-2xl border-4 border-yellow-400">
                <h2 className="text-2xl font-black text-purple-700 mb-3">üìñ Your AI Story!</h2>
                <p className="text-xl text-gray-800 leading-relaxed">{story}</p>
                <button
                  onClick={generateStory}
                  className="mt-4 bg-purple-500 text-white px-4 py-2 rounded-xl font-bold hover:bg-purple-600"
                >
                  üîÑ Generate Another!
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<AIStoryDice />);
  </script>
</body>
</html>